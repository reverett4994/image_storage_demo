<div id="user_page_wrapper">

  <h1> <%=@user.email%>'s PAGE </h1>

  <% if user_signed_in? %>
    <div id="user_banner">
      <div class="banner_pic"><img src="/BWuser.png"></div>
      <div class="banner_user"><%=@user.email[/[^@]+/]%>'s <br>Page</div>
      <div class="banner_item"><h6>Total Images</h6><p><%=@user.images.count%></p></div>
      <div class="banner_item"><h6>Public Images</h6><p><%=@public_count.to_i%></p></div>
      <div class="banner_item"><h6>Friends Only Images</h6><p><%=@friends_count.to_i%></p></div>
      <div class="banner_item"><h6>Private Images</h6><p><%=@private_count.to_i%></p></div>
    </div>
     <% if current_user == @user %>
        <h4>Welcome to Your Page</h4>

        <h4>Your Friends </h4>
        <% @user.friends.each do |u| %>
          <%= link_to u.email,"/users/#{u.id}" %> <br>
        <%end%>
        <h4>Your Pending Friend Requests </h4>
        <% @user.pending_friends.each do |u| %>
          <%=u.email%> <button class="accept" value=<%=u.email%>>Accept Friend</button><br>
        <%end%>

        <h4>Your Requested Friends</h4>
        <% @user.requested_friends.each do |u| %>
          <%=u.email%><br>
        <%end%>
        <a href="/images" class="btn btn-4"><span>My Pictures</span></a><br>

        <a href="/albums" class="btn btn-4"><span>My Albums</span></a>
     <% elsif current_user.pending_friends.include?(@user)%>
        <h4> Friend Request Pending</h4>
      <%else%>
        <button type="button" class="request">Request Friendship!</button>
     <%end%>
  <%end%>



  <% if  user_signed_in? == false  || current_user != @user%>
    <%= link_to "#{@user.email} Pictures",images_path(:user => @user.id)%><br>
    <a href="/albums" class=""><span><%=@user.email%> Albums</span></a>
  <%end%>

</div>
<script>

$( ".request" ).click(function() {
  var friend = gon.user;
  console.log(friend);

  $.ajax({
    type: "POST",
    url: "/users/request-friend",
    dataType:"json",
    data: {friend:friend},
    success:function(data) {
      console.log("good");
      alert("request sent!")
      return false;
    },
    error:function(data) {
      console.log("bad");
      console.log(data);
      return false;
    }
  });
});

$( ".accept" ).click(function() {
  var friend = $(this).val();
  console.log(friend);

  $.ajax({
    type: "POST",
    url: "/users/accept-friend",
    dataType:"json",
    data: {friend:friend},
    success:function(data) {
      console.log("good");
      alert("Friend Added!")
      return false;
    },
    error:function(data) {
      console.log("bad");
      console.log(data);
      return false;
    }
  });
});
</script>
